name: Update monthly delays chart

on:
  push:
    branches:
      - erik
  pull_request:
    branches:
      - erik

jobs:
  run-analysis:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas scipy numpy

    - name: Run Python script
      run: |
        python code/get_filtered_weekends_vacation_covid_delays.py

    - name: Commit filtered weekends vacation covid delays
      run: |
        git config --global user.name 'github-actions'
        git config --global user.email 'github-actions@github.com'
        git add data/output/filtered_weekends_vacation_covid_delays.csv
        git commit -m 'Update filtered weekends vacation covid delays'
        git push

    - name: Set up R
      uses: r-lib/actions/setup-r@v2

    - name: Install R dependencies
      run: |
        Rscript -e 'install.packages(c("dplyr", "readr", "lubridate", "reticulate", "tidyr", "highcharter", "htmlwidgets"), repos="https://cloud.r-project.org/")'

    - name: Run R script
      run: |
        Rscript code/get_num_monthly_delays.r

    - name: Commit num monthly delays
      run: |
        git config --global user.name 'github-actions'
        git config --global user.email 'github-actions@github.com'
        git add visuals/num_monthly_delays1.html
        git commit -m 'Update num monthly delays'
        git push